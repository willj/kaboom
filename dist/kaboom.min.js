var Kaboom={gameOverCallback:null,drawCallback:null,updateCallback:null,updateOncePerSecondCallback:null,initialize:function(t,s){this.settings=t,this.gameLoopIntervalId,this.actors=[],this.frameCount=0,this.approxRunTimeInSeconds=0,this.gameOver=!1,this.canvas=Object.create(KaboomCanvas),this.canvas.create(this.settings,this.approxRunTimeInSeconds),this.assets=Object.create(KaboomAssetManager),this.assets.loadedCallback=s,this.assets.loadAll(this.settings)},startGame:function(){var t=this;this.gameLoopIntervalId=setInterval(function(){t.update(),t.draw()},1e3/t.settings.framesPerSecond)},stopGame:function(){clearInterval(this.gameLoopIntervalId),this.gameOver=!0,this.actors.splice(0,this.actors.length),this.gameOverCallback&&this.gameOverCallback.apply(this)},restartGame:function(){clearInterval(this.gameLoopIntervalId),this.actors.splice(0,this.actors.length),this.draw(),this.frameCount=0,this.approxRunTimeInSeconds=0,this.gameOver=!1,this.startGame()},update:function(){this.frameCounter(),this.updateOncePerSecond();for(var t=[],s=0;s<this.actors.length;s++)this.actors[s].update(),this.actors[s].killed&&t.push(s);for(var s=0;s<t.length;s++)this.actors.splice(t[s],1);this.updateCallback&&this.updateCallback.apply(this)},draw:function(){this.canvas.context.clearRect(0,0,this.canvas.getWidth(),this.canvas.getHeight());for(var t=0;t<this.actors.length;t++)this.actors[t].draw(this.canvas.context);this.drawCallback&&this.drawCallback.apply(this)},frameCounter:function(){this.frameCount=(this.frameCount+1)%this.settings.framesPerSecond},updateOncePerSecond:function(){0===this.frameCount&&(this.approxRunTimeInSeconds+=1,this.updateOncePerSecondCallback&&this.updateOncePerSecondCallback.apply(this,[this.approxRunTimeInSeconds]))},getRandomInt:function(t,s){return Math.floor(Math.random()*(s-t))+t}},KaboomActor={init:function(t,s,e,i){this.name=t,this.sprite=s,this.posX=e||0,this.posY=i||0,this.killed=!1,this.currentState="initial",this.currentStateFrameCount=this.sprite.states[this.currentState].length,this.currentFrame=0,this.currentSourceX=this.sprite.states[this.currentState][this.currentFrame]*this.sprite.width,this.tickCount=0,this.ticksPerUpdate=1,this.ticksToLive=-2,this.velocityX=0,this.velocityY=0,this.rotation=0,this.shouldRotate=!1},kill:function(){this.killed=!0},update:function(){this.tickCount=(this.tickCount+1)%this.ticksPerUpdate,this.ticksToLive>-2&&(this.ticksToLive--,this.ticksToLive<1&&(this.killed=!0)),this.posX+=this.velocityX,this.posY+=this.velocityY,this.updateFrame()},draw:function(t){if(this.shouldRotate){t.save();var s=this.posX+this.sprite.width/2,e=this.posY+this.sprite.height/2;t.translate(s,e),t.rotate(this.rotation*Math.PI/180),t.translate(-s,-e)}t.drawImage(this.sprite.image,this.currentSourceX,this.sprite.sourceY,this.sprite.width,this.sprite.height,this.posX,this.posY,this.sprite.width,this.sprite.height),this.shouldRotate&&t.restore()},rotateBy:function(t){this.rotation+=t,this.shouldRotate=!0},rotateTo:function(t){this.rotation=t,this.shouldRotate=!0},setState:function(t){this.currentState=t,this.currentStateFrameCount=this.sprite.states[this.currentState].length,this.currentFrame=0},updateFrame:function(){this.tickCount>0||(this.currentFrame+=1,this.currentFrame>this.currentStateFrameCount&&(this.currentFrame=0),"string"==typeof this.sprite.states[this.currentState][this.currentFrame]?"die"===this.sprite.states[this.currentState][this.currentFrame]?this.killed=!0:this.setState(this.sprite.states[this.currentState][this.currentFrame]):this.currentSourceX=this.sprite.states[this.currentState][this.currentFrame]*this.sprite.width)}},KaboomAssetManager={images:{},sounds:{},sprites:{},assetsLoaded:0,loadedCallback:null,loadAll:function(t){this.settings=t;for(var s=0;s<this.settings.assetMap.length;s++)"Image"===this.settings.assetMap[s].fileType?this.loadImage(this.settings.assetMap[s]):"Sound"===this.settings.assetMap[s].fileType&&this.loadSound(this.settings.assetMap[s])},loadImage:function(t){var s=new Image;this.images[t.fileName]=s,s.onload=this.assetLoaded(t),s.src=this.settings.assetDirectory+t.fileName},loadSound:function(t){var s=new Audio;this.sounds[t.name]=s,s.onload=this.assetLoaded(t),s.src=this.settings.assetDirectory+t.fileName},assetLoaded:function(t){if(this.assetsLoaded+=1,"Image"===t.fileType)for(var s=0;s<t.sprites.length;s++){var e=t.sprites[s];this.sprites[e.name]=Object.create(KaboomSprite),this.sprites[e.name].init(this.images[t.fileName],e.startX,e.startY,e.width,e.height,e.states)}this.assetsLoaded==this.settings.assetMap.length&&this.loadedCallback&&this.loadedCallback.apply(this)},playSound:function(t,s,e){var i=s||!1,a=e||!1;null!=this.sounds[t]&&(this.settings.playAllSounds===!0||i===!1)&&(this.sounds[t].loop=a,this.sounds[t].play())},pauseSound:function(t){null!=this.sounds[t]&&this.sounds[t].pause()},activateSounds:function(){if(navigator.userAgent.search(/iPad|iPhone|Android|Linux/))for(var t=0;t<this.settings.assetMap.length;t++)"Sound"===this.settings.assetMap[t].fileType&&(this.sounds[this.settings.assetMap[t].name].play(),this.sounds[this.settings.assetMap[t].name].pause())}},KaboomCanvas={create:function(t){this.settings=t,this.containerElement=document.getElementById(this.settings.containerElementId),this.settings.canvasWidth&&this.settings.canvasHeight||this.detectContainerSize(),this.canvasElement=document.createElement("canvas"),this.context=this.canvasElement.getContext("2d"),this.canvasElement.width=this.settings.canvasWidth,this.canvasElement.height=this.settings.canvasHeight,this.containerElement.appendChild(this.canvasElement)},resize:function(t,s){t&&s?(this.settings.canvasWidth=t,this.settings.canvasHeight=s):this.detectContainerSize(),this.canvasElement.width=this.settings.canvasWidth,this.canvasElement.height=this.settings.canvasHeight},detectContainerSize:function(){this.settings.canvasWidth=this.containerElement.clientWidth,this.settings.canvasHeight=this.containerElement.clientHeight},getWidth:function(){return this.canvasElement.width},getHeight:function(){return this.canvasElement.height},animationClassApplied:!1,applyAnimationClass:function(t,s){0==this.animationClassApplied&&(this.canvasElement.className=t,this.animationClassApplied=!0,setTimeout(this.removeAnimationClass(this),1e3*s))},removeAnimationClass:function(t){return function(){t.canvasElement.className="",t.animationClassApplied=!1}}},KaboomSprite={init:function(t,s,e,i,a,n){this.image=t,this.sourceX=s||0,this.sourceY=e||0,this.width=i||t.width,this.height=a||t.height,this.states=n}};